from controller import loadPresets, handleScan, createPreset, deletePreset


def mainMenu():
    print("Please keep in mind 'exit' can be typed to leave a menu at any time")
    choosing = True
    while choosing:
        scanChoice = input("Options:\n1. Default scan\n2. Presets\n3. Manage presets\n>").lower().strip()
        if scanChoice == "default scan" or scanChoice == "1":
            print("")
            resultsMenu(handleScan())
        elif scanChoice == "presets" or scanChoice == "2":
            print("")
            choosePreset()
        elif scanChoice == "manage presets" or scanChoice == "3":
            print("")
            managePresetsMenu()
        elif scanChoice == "exit":
            choosing = False
        else:
            print("Please enter valid option\n")


def managePresetsMenu():
    customChoice = input("Options:\n1. Create\n2. Delete\n3. Load\n>").lower().strip()
    print("")
    if customChoice == "create" or customChoice == "1":
        done = False
        while not done:
            name = input("Name: ").strip()
            ports = input("ports (separated by commas): ").strip()
            getOS = input("get operating system? (True or False): ").lower().strip()
            ports = ports.split(",")
            newPorts = []
            try:
                for port in ports:
                    newPorts.append(int(port.strip()))
                if getOS == "true":
                    getOS = True
                    done = True
                elif getOS == "false":
                    getOS = False
                    done = True
                else:
                    print("invalid get operating system value")
            except:
                print("invalid ports")
        createPreset([name, newPorts, getOS])
        print("Preset created\n")

    elif customChoice == "delete" or customChoice == "2":
        done = False
        printPresets()
        presetLen = len(loadPresets())
        while not done:
            presetNum = input("Enter the preset number to delete: ").strip().lower()
            if presetNum.isnumeric():
                presetIndex = int(presetNum) - 1
                if presetIndex <= presetLen:
                    deletePreset(presetIndex)
                    print("Preset deleted\n")
                    done = True
                else:
                    print("not a valid preset number")
            elif presetNum == "exit":
                done = True
            else:
                print("enter a number")


    elif customChoice == "load" or customChoice == "3":
        printPresets()

def printPresets():
    i = 1
    for preset in loadPresets():
        ports = ((str(preset["ports"])).removeprefix("[")).removesuffix("]")
        print(str(i) + ".")
        print("Name: " + preset["name"])
        print("Ports: " + ports)
        print("GetOS: " + str(preset["getOS"]))
        print("")
        i += 1

def choosePreset():
    print("\nChoose preset number:\n")
    printPresets()
    numOfPresets = len(loadPresets())
    validPreset = False
    while not validPreset:
        presetChoice = input(">")
        if presetChoice.isnumeric():
            presetChoice = int(presetChoice)
            if presetChoice in range(numOfPresets):
                handleScan(int(presetChoice))
                validPreset = True
            else:
                print("input a number in range")
        else:
            print("input a number")


def resultsMenu(results):
    pass


if __name__ == "__main__":
    mainMenu()
